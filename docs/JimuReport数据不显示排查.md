# JimuReport 数据不显示排查说明

## 一、MySQL 数据已确认存在

当前 `htma_dashboard` 库中数据量：

| 表名 | 记录数 |
|------|--------|
| t_htma_profit | 13,235 |
| t_htma_sale | 90,853 |
| t_htma_stock | 120,811 |

数据已在库中，数据源连接正常时，SQL 数据集里的「数据预览」能查到数据是正常现象。

---

## 二、「数据预览」有数据、但报表里不显示的常见原因

你截图里 **SQL 数据集 → 数据预览** 已经能看到 `t_htma_profit` 的几条数据，说明：

- 数据源「好特卖数据」连接正常  
- SQL `select * from t_htma_profit` 执行正常  
- **问题不在 MySQL，而在报表设计：单元格没有绑定数据集，或没有设置数据行**

报表设计器里若不绑单元格、不设数据行，预览时就不会按数据集循环出数，所以「MySQL 有数据但报表上看不到」。

---

## 三、正确做法：绑定数据集 + 设置数据行

### 1. 保存当前 SQL 数据集

在「SQL数据集」弹窗里点 **确定**，把当前数据集（如 `htma_profit`）保存到报表中。

### 2. 在报表画布上做两件事

**（1）表头（第 1 行）**

- A1：日期  
- B1：品类  
- C1：总销售额  
- D1：总毛利  
- E1：毛利率  
- F1：门店  
（按你实际需要的列来写表头即可。）

**（2）数据行（第 2 行）——必须做**

- 把 **第 2 行** 设为 **数据行**，并绑定到当前数据集（如 `htma_profit`）。  
  - 做法：选中第 2 行（点行号）→ 右键或右侧属性 →「设为数据行」/「数据行」→ 选择数据集 `htma_profit`。
- 在 **第 2 行** 的单元格里绑定字段（二选一）：
  - **拖拽**：左侧「数据集管理」展开 `htma_profit`，把 `data_date` 拖到 A2，`category` 拖到 B2，`total_sale` 拖到 C2，`total_profit` 拖到 D2，`profit_rate` 拖到 E2，`store_id` 拖到 F2。
  - **手动**：  
    - A2 值：`#{htma_profit.data_date}`  
    - B2 值：`#{htma_profit.category}`  
    - C2 值：`#{htma_profit.total_sale}`  
    - D2 值：`#{htma_profit.total_profit}`  
    - E2 值：`#{htma_profit.profit_rate}`  
    - F2 值：`#{htma_profit.store_id}`  
    （若数据集编码不是 `htma_profit`，把表达式里的 `htma_profit` 改成你实际的数据集编码。）

### 3. 预览与保存

- 点右上角 **预览**：应能看到多行数据（表头 + 数据行按数据集循环）。  
- 再点 **保存**，报表里就会按当前配置从 MySQL 取数并显示。

---

## 四、关于「数据预览」只显示 10 条

SQL 数据集界面下方提示「仅显示10条数据」是**产品限制**：预览最多只显示 10 条，不影响真实报表。报表预览和发布后会按数据集全部记录显示（或按分页设置显示），不会只显示 10 条。

---

## 五、小结

| 现象 | 原因 | 处理 |
|------|------|------|
| 数据预览有数据，报表里没有 | 未绑定单元格或未设数据行 | 按第三节绑定字段并设置第 2 行为数据行 |
| 只看到 10 条 | 数据集预览限制 | 正常，报表预览/发布会显示全部或分页 |
| 数据预览也没有数据 | 数据源/SQL/库表问题 | 检查数据源、SQL、表名与权限 |

按上面步骤做完「数据行 + 单元格绑定」后，报表里就会正常显示 MySQL 里已有的数据。

---

## 六、已通过 SQL 自动绑定的报表（可直接用）

已用脚本在库中插入一张**已绑定好数据**的报表，无需在设计器里再拖字段。

- **报表 ID**：`8946110000000000001`（须为数字 id 且 ≤ Java Long 最大值，否则设计页会 404 或报错）
- **报表名称**：好特卖销售明细
- **数据集**：`htma_profit`（SQL：`SELECT data_date, category, total_sale, total_profit, profit_rate, store_id FROM t_htma_profit ORDER BY data_date, category`）
- **表头**：日期、品类、总销售额、总毛利、毛利率、门店
- **数据行**：第 2 行已绑定上述 6 个字段，预览时会按数据集循环出数

**如何打开：**

1. 登录 JimuReport：http://127.0.0.1:8085（admin / 123456）
2. **推荐**：进入报表列表 http://127.0.0.1:8085/jmreport/list → 左侧点「数据报表」→ 找到 **「好特卖销售明细」** → 点卡片上的 **编辑/设计**，会带 token 打开设计页。
3. 若直接拼地址，请用 **index** 路径（本示例项目未注册 desreport/view 路径，会 404）：
   - **设计页**：`http://127.0.0.1:8085/jmreport/index/8946110000000000001?menuType=984272091947253760`
   - 预览可在设计页工具栏点「预览」，或从列表页点该报表的「预览」。

**重新执行绑定脚本（覆盖/更新该报表时）：**

```bash
mysql -h 127.0.0.1 -u root -p62102218 jimureport --default-character-set=utf8mb4 < scripts/fix_htma_report_id.sql
```
