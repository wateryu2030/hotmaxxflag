# 好特卖超级仓数据看板实施方案

> 基于 JimuReport（积木报表）设计，实现门店收入、盈利、品类分析及同比/环比数据的可视化展示。

---

## 一、前期准备：数据规整 + 环境搭建

### 1. 数据规整（核心前提）

将好特卖 3 张原始表格梳理成 JimuReport 可直接使用的格式，重点明确**关联字段**和**数据清洗规则**：

| 表格类型 | 核心字段 | 关联关键字段 | 清洗规则 |
|----------|----------|--------------|----------|
| 库存表 | 商品编码、品类、库存数量、库存金额、日期 | 日期、商品编码、品类 | 1. 日期统一为 `YYYY-MM-DD`；<br>2. 剔除库存数量为负的异常值；<br>3. 补充缺失的「品类」字段（按商品编码匹配） |
| 销售表 | 商品编码、品类、销售数量、销售额、销售成本、日期 | 日期、商品编码、品类 | 1. 计算单品毛利 = 销售额 - 销售成本；<br>2. 按「日期 + 品类」汇总销售额/毛利 |
| 毛利表 | 日期、品类、总销售额、总毛利、毛利率、门店ID | 日期、品类、门店ID | 1. 校验毛利率 = 总毛利/总销售额（修正计算错误）；<br>2. 统一门店ID为「沈阳超级仓」 |

**最终输出**：整理后的 3 张 Excel 表（或导入 MySQL 数据库），确保「日期、商品编码、品类、门店ID」能跨表关联。

### 2. JimuReport 环境搭建

#### 方式一：快速试用（无需集成，直接用官方示例）

1. **环境要求**：JDK17+、MySQL5.7+、Maven3.6+
2. **下载**：<https://gitee.com/jeecg/JimuReport/>
3. **执行数据库初始化**：`db/jimureport.mysql5.7.create.sql`（创建报表所需基础表）
4. **启动项目**：运行 `org.jeecg.modules.JimuReportApplication`
5. **访问控制台**：
   - 仪表盘设计入口：http://localhost:8085/drag/list
   - 默认账号/密码：admin / 123456

#### 方式二：集成到自有系统（长期使用）

1. **引入依赖**（SpringBoot 3.x 为例）：

```xml
<dependency>
    <groupId>org.jeecgframework.jimureport</groupId>
    <artifactId>jimureport-spring-boot3-starter</artifactId>
    <version>2.3.0</version>
</dependency>
```

2. **配置数据源**（application.yml）：

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/jimureport?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=true&serverTimezone=GMT%2B8
    username: root
    password: 123456
    driver-class-name: com.mysql.cj.jdbc.Driver
```

3. 启动项目后访问上述控制台地址即可。

---

## 二、核心步骤：JimuReport 看板设计实操

### 步骤 1：配置数据源（关联好特卖数据）

JimuReport 支持 Excel / 数据库两种数据源。针对好特卖小体量数据（49 天、约 1.7 万条商品记录），建议先试用 Excel 导入，长期使用转数据库。

#### 操作 1：Excel 数据源导入

1. 控制台 → 数据源管理 → 新增数据源 → 选择「Excel 数据源」
2. 上传整理后的 3 张好特卖 Excel 表，系统自动识别表头
3. 为每张表设置别名（如「沈阳仓_库存表」「沈阳仓_销售表」），设置主键（如「日期 + 商品编码」）
4. 配置表间关联：在「关联设置」中绑定  
   - `销售表.商品编码 = 库存表.商品编码`  
   - `销售表.日期 = 毛利表.日期`  
   实现多表联动查询

#### 操作 2：数据库数据源导入（推荐）

1. 将整理后的 Excel 数据导入 MySQL，创建 3 张表：`t_htma_stock`、`t_htma_sale`、`t_htma_profit`
2. 在 JimuReport 中新增「MySQL 数据源」，填写数据库地址/账号/密码，测试连接后保存
3. 选择已创建的 3 张表，按上述规则配置表间关联

### 步骤 2：看板框架设计（布局规划）

1. 仪表盘设计 → 新建仪表盘 → 命名「好特卖沈阳超级仓运营看板」
2. 选择「自由布局」，拖拽「行/列容器」划分区域：
   - **顶部**：核心指标区（4 个数字卡片：总销售额、总毛利、毛利率、库存总额）
   - **左侧**：品类分析区（饼图 + 柱状图）
   - **右侧**：趋势分析区（组合图：销售额/毛利率同比、环比）
   - **底部**：库存预警区（预警卡片 + 数据表格）

### 步骤 3：核心组件制作（按模块落地）

#### 模块 1：核心指标概览（数字卡片）

- 拖拽「数字卡片」，绑定毛利表/销售表
- 计算方式：求和（总销售额、总毛利）、平均值（毛利率）
- 添加筛选条件：默认「近 30 天」，支持切换时间段
- 样式：毛利率 ≥ 35% 绿色，< 35% 黄色

#### 模块 2：品类分析（饼图 + 柱状图）

- **饼图**：X 轴「品类」，Y 轴「销售额（求和）」；显示前 5 大品类，其余归为「其他」
- **柱状图**：X 轴「品类」，Y 轴「毛利（求和）」；分组字段「日期（按月）」

#### 模块 3：同比/环比趋势分析（组合图）

- **环比公式**：`(当日销售额 - 前日销售额) / 前日销售额 * 100%`
- **同比公式**（有去年同期数据时）：`(本期 - 去年同期) / 去年同期 * 100%`

#### 模块 4：库存预警

- 预警规则：库存数量 < 最小库存阈值（如食品饮料类 < 50 件）
- 明细表格：商品编码、品类、库存数量、销售数量、销售额、毛利；支持筛选、排序、导出

### 步骤 4：交互与联动配置

1. **全局筛选**：日期筛选器绑定所有组件
2. **钻取**：品类饼图点击下钻至子类
3. **联动**：点击趋势图某天，明细表格显示当天数据

### 步骤 5：测试优化 + 发布

1. 校验总销售额、毛利率与原始数据一致
2. 统一图表配色、字体、移动端适配
3. 发布后生成访问链接/二维码，配置角色权限

---

## 三、实施清单（Checklist）

- [ ] 数据规整完成（3 张表、关联字段、清洗规则）
- [ ] JimuReport 环境搭建完成
- [ ] 数据源配置（MySQL / Excel 导入 + 表间关联）
- [ ] 看板布局划分完成
- [ ] 核心指标卡片（4 个）完成
- [ ] 品类分析（饼图 + 柱状图）完成
- [ ] 同比/环比趋势图完成
- [ ] 库存预警 + 明细表完成
- [ ] 交互联动配置完成
- [ ] 数据校验通过
- [ ] 发布并配置权限

---

## 四、关联文件说明

| 文件 | 说明 |
|------|------|
| `../scripts/01_create_tables.sql` | MySQL 建表脚本 |
| `../scripts/02_data_cleaning.sql` | 数据清洗脚本 |
| `../scripts/jimureport/01a~01d_*.sql` | 核心指标 SQL（4 个数字卡片） |
| `../scripts/jimureport/02_category_analysis.sql` | 品类分析 SQL |
| `../scripts/jimureport/03_yoy_mom_trend.sql` | 同比/环比趋势 SQL |
| `../scripts/jimureport/04_inventory_alert.sql` | 库存预警 SQL |
