# 库存数据导入说明（库存查询_默认格式）

## 一、重建数据表

执行以下命令，按「库存查询_默认」Excel 结构重建 `t_htma_stock` 表：

```bash
mysql -h 127.0.0.1 -u root -p62102218 htma_dashboard < scripts/05_create_stock_table_v2.sql
```

## 二、支持的 Excel 列（库存查询_默认）

| Excel 列名 | 数据库字段 | 说明 |
|-----------|-----------|------|
| 仓库 | warehouse_code | 仓库编码 |
| 仓库名称 | warehouse_name | 仓库名称 |
| 货号 | sku_code | 商品编码 |
| 品类 | category | 品类 |
| 大类编码 | category_large_code | 大类编码 |
| 大类名称 | category_large | 大类名称 |
| 中类编码 | category_mid_code | 中类编码 |
| 中类名称 | category_mid | 中类名称 |
| 小类编码 | category_small_code | 小类编码 |
| 小类名称 | category_small | 小类名称 |
| 规格 | spec | 规格 |
| 库位名称 | location_name | 库位名称 |
| 品牌 | brand_name | 品牌 |
| 单位 | unit | 单位 |
| 品号 | product_code | 品号 |
| 库存数量 | stock_qty | 库存数量 |
| 平均价 | avg_price | 平均价 |
| 库存总金额 | stock_amount | 库存总金额 |
| 账龄 | aging | 账龄 |
| 上次变动日期 | last_change_date | 上次变动日期 |
| 平均入库价 | avg_inbound_price | 平均入库价 |
| SKU商品状态 | product_status | 商品状态 |
| 条码 | barcode | 条码 |

## 三、导入方式

1. **Web 导入**：打开 http://127.0.0.1:5002/import ，在「实时库存」处选择 Excel 文件上传。
2. **命令行**：将 Excel 放到指定目录后，执行 `npm run htma:import` 或 `python scripts/auto_import_and_verify.py`。

## 四、日期说明

- `data_date`（库存日期）：从文件名提取（如 `库存查询_2026-02-15.xlsx`），缺省为当天。
- `last_change_date`（上次变动日期）：从 Excel 中「上次变动日期」列解析。

## 五、兼容性

导入逻辑同时支持：
- **旧格式**（24 列）：仓库编码、仓库名称、类别、类别名称、货号、国际条码、商品名称、规格、单位、商品状态、分店经营、实时库存、库存箱数、库存金额(零售价)、售价、商品简称、品牌编码、品牌名称、供应商编码、主供应商、库位、库位名称、联系方式、经营方式
- **新格式**（库存查询_默认）：按表头自动识别上述列
