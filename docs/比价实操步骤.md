# 商品比价实操步骤（详细版）

## 一、快速跑通（5 分钟，用模拟数据）

先确认整套流程能跑通，再接入真实 API。

### 步骤 1：确保 MySQL 有数据与结果表

```bash
# 确认 MySQL 已启动，htma_dashboard 库有销售/库存数据
mysql -h 127.0.0.1 -u root -p -e "SELECT COUNT(*) FROM htma_dashboard.t_htma_sale;"

# 若 t_htma_price_compare 表不存在，先创建
mysql -h 127.0.0.1 -u root -p htma_dashboard < scripts/07_create_price_compare.sql
```

### 步骤 2：执行比价脚本

```bash
cd /Users/document/好特卖超级仓/数据分析
npm run htma:price_compare
```

### 步骤 3：查看报告

终端会输出货盘分层报告。此时竞品价为**模拟数据**，用于验证流程。

---

## 二、接入真实比价 API（推荐：聚合数据）

### 步骤 1：注册聚合数据

1. 打开 https://www.juhe.cn/register
2. 注册账号（手机号/邮箱）
3. 登录后进入「个人中心」

### 步骤 2：实名认证

1. 个人中心 → 实名认证
2. 按提示完成身份证等认证（商品比价需个人或企业实名）

### 步骤 3：申请商品比价接口

1. 打开 https://www.juhe.cn/docs/api/id/137
2. 若页面显示「维护中」：联系客服 0512-88869195 确认是否恢复
3. 若可申请：点击「申请接口」→ 填写应用场景（如：零售门店货盘价格对比分析）→ 提交审核
4. 审核通过后，在「我的 API」中获取 **key**

### 步骤 4：配置 .env

编辑项目根目录 `.env`，填入：

```bash
JUHE_PRICE_KEY=你获取的key
```

### 步骤 5：重新执行比价

```bash
cd /Users/document/好特卖超级仓/数据分析
npm run htma:price_compare
```

此时报告中的竞品价应为**真实数据**。

---

## 三、百度云市场路径（备选）

若聚合数据不可用，可在百度云市场寻找返回价格的 API。

### 步骤 1：进入 API 商城

1. 打开 https://apis.baidu.com/ 或 云市场首页点击「API商城」
2. 在搜索框输入：**商品搜索** 或 **商品比价** 或 **电商价格**

### 步骤 2：筛选与购买

1. 查看商品详情，确认返回结果中**包含 price 字段**
2. 商品条码类 API 通常**不返回价格**，需跳过
3. 选择支持「关键词搜索」且返回价格的 API
4. 购买后，在「已购 API」中查看调用地址、参数、鉴权方式

### 步骤 3：配置与接入

- 若使用 **apikey**：填入 `.env` 的 `BAIDU_APISTORE_KEY`
- 若使用 **百度 AK/SK**：已配置 `BAIDU_AK`、`BAIDU_SK`，需在 `baidu_fetcher.py` 中按该 API 文档实现调用逻辑

---

## 四、通过看板执行比价

### 方式 1：API

```bash
# 先启动看板
cd /Users/document/好特卖超级仓/数据分析
npm run htma:run

# 另开终端调用
curl "http://127.0.0.1:5002/api/price_compare?days=30"
```

### 方式 2：AI 对话

1. 浏览器打开 http://127.0.0.1:5002
2. 在「AI 对话」输入：**哪些货品性价比高？** 或 **价格与百度识货对比**
3. 系统自动执行 4 阶段分析并返回报告

---

## 五、OpenClaw 一键触发

### 步骤 1：配置 OpenClaw Skill

在 OpenClaw 的 skills 配置中加入（格式以 OpenClaw 文档为准）：

```yaml
- name: htma-price-compare
  description: 执行货盘价格对比分析
  trigger: |
    当用户说「货盘分析」「价格对比」「性价比分析」「动态比价」时触发
  action: |
    cd /Users/document/好特卖超级仓/数据分析 && npm run htma:price_compare
```

### 步骤 2：触发

对 OpenClaw 说：「货盘分析」或「价格对比」，即可执行。

---

## 六、常见问题

| 问题 | 处理 |
|------|------|
| 聚合数据显示「维护中」 | 联系客服 0512-88869195 或尝试其他数据源 |
| 报告里竞品价仍是模拟数据 | 检查 `.env` 中 `JUHE_PRICE_KEY` 是否正确，重启看板/脚本 |
| MySQL 连接失败 | 确认 MySQL 已启动，`.env` 或默认配置中密码正确 |
| 无销售数据 | 先执行 `npm run htma:import` 导入 Excel 数据 |

---

## 七、验收清单

- [ ] `npm run htma:price_compare` 能正常输出报告
- [ ] 配置 JUHE_PRICE_KEY 后，报告中出现真实竞品价（非「模拟」）
- [ ] 看板 AI 对话输入「性价比」能返回货盘分析
- [ ] 可选：OpenClaw 说「货盘分析」能触发执行
